// This file is part of Moodle - http://moodle.org/
//
// Moodle is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// Moodle is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.

/**
 *
 * @package    local_mb2builder
 * @license    Commercial https://themeforest.net/licenses
 */
define(["jquery","theme_mb2nl/swiper","local_mb2builder/selectors","local_mb2builder/helper"],function(e,t,a,r){var s=function(r){if(r){e("#"+r).find(".swiper-notification").remove();new t("#"+r,n(e("#"+r)))}else e(a.builder.buildercontainer+" "+a.layout.carousel).each(function(){new t("#"+e(this).attr("id"),n(e(this)))})},n=function(e){var t=e,r=e.closest(a.elements.coursetabs),s=e.closest(a.layout.element);r.length&&(t=r),s.length&&(t=s);var n=Number(t.attr("data-columns")),i=1==t.attr("data-mobcolumns"),o=1==t.attr("data-sloop"),l=1==t.attr("data-autoplay"),d=Number(t.attr("data-pausetime")),u=Number(t.attr("data-animtime")),p=30;"thin"===t.attr("data-gutter")?p=10:"none"===t.attr("data-gutter")&&(p=0);var c=i?2:1,m=n>3?3:n,b=d;return o&&l||(b=36e5),{slidesPerView:n,spaceBetween:p,allowTouchMove:!0,loop:o,speed:u,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0},autoplay:{delay:b,disableOnInteraction:!1},breakpoints:{0:{slidesPerView:c},480:{slidesPerView:c},600:{slidesPerView:i?m:n>2?2:n},768:{slidesPerView:m},1000:{slidesPerView:n>5?5:n}},watchSlidesProgress:!0}},i=function(e){new t("#"+e).destroy(),o(e)},o=function(t){var a=e("#"+t).find(".swiper-wrapper").clone(),r=a.find(".mb2-pb-carousel-item");a.find(".swiper-slide-duplicate").remove(),a.removeAttr("id"),a.removeAttr("class"),a.removeAttr("style"),a.removeAttr("aria-live"),r.removeAttr("class"),r.removeAttr("style"),r.removeAttr("role"),r.removeAttr("data-swiper-slide-index"),r.removeAttr("aria-label"),a.addClass("swiper-wrapper"),a.addClass("mb2-pb-content-list"),r.addClass("mb2-pb-carousel-item"),r.addClass("theme-slider-item"),r.addClass("swiper-slide"),e("#"+t).empty(),e("#"+t).append(l()),e("#"+t).append(a),e("#"+t).append(d())},l=function(){return'<div class="theme-carousel-nav">','<button type="button" class="swiper-button-nav swiper-button-prev themereset"></button>','<button type="button" class="swiper-button-nav swiper-button-next themereset"></button>',"</div>",'<div class="theme-carousel-nav"><button type="button" class="swiper-button-nav swiper-button-prev themereset"></button><button type="button" class="swiper-button-nav swiper-button-next themereset"></button></div>'},d=function(){return'<div class="theme-carousel-pagenavnav">','<div class="swiper-pagination"></div>',"</div>",'<div class="theme-carousel-pagenavnav"><div class="swiper-pagination"></div></div>'};return{carouselInit:s,carouselDestroy:i,carouselSortItems:function(t){var r=t.closest(a.layout.element).find(a.layout.carousel),n=[],o=0;i(r.attr("id"));var l=r.find(a.layout.carouselwrapper);for(t.closest(a.layout.element).find(a.layout.carouselsubelementitem).each(function(){n[o]=e(this).attr("data-pbid"),o++}),x=0;x<n.length;x++){var d=l.find(a.layout.carouselitem+'[data-pbid="'+n[x]+'"]');l.append(d)}s(r.attr("id"))},carouselPrepare:function(t){var s=r.uniqId(),n=0,i=0,o=[];t.closest(a.layout.element).find(a.layout.carousel).attr("id","swiper_prepare_"+s),t.find(a.layout.carouselitem).each(function(){o[++n]=s+n,e(this).attr("data-pbid",s+n)});var l=t.find(a.layout.subelement);l.length&&l.each(function(){i++,e(this).attr("data-pbid",o[i])})},columnsToCarousel:function(e){var t=r.uniqId(),a=e.find(".mb2-pb-content-list");a.removeClass("theme-boxes"),a.removeClass("theme-col-"+e.attr("data-columns")),a.removeClass("gutter-"+e.attr("data-gutter")),e.find(".mb2-pb-content-inner").addClass("swiper"),a.addClass("swiper-wrapper"),a.find(">div").addClass("swiper-slide"),e.find(".mb2-pb-content-inner").attr("id","swiper_"+t)},carouselToColumns:function(e){e.find(".mb2-pb-content-inner").removeClass("swiper");var t=e.find(".mb2-pb-content-list");t.removeClass("swiper-wrapper"),t.find(">div").removeClass("swiper-slide"),t.addClass("theme-boxes"),t.addClass("theme-col-"+e.attr("data-columns")),t.addClass("gutter-"+e.attr("data-gutter")),t.find(">div").addClass("theme-box")},coursesPrepare:function(e){var t=r.uniqId();e.closest(a.layout.element).find(".mb2-pb-element-inner").attr("id","swiper_prepare_"+t)},carouselDuplicateItem:function(e,t){var n=r.uniqId(),o=e.closest(a.layout.subelement),l=e.closest(a.layout.element).find(a.layout.carousel);i(l.attr("id"));var d=l.find(a.layout.carouselwrapper),u=e.closest(a.layout.element).find('.mb2-pb-carousel-item[data-pbid="'+o.attr("data-pbid")+'"]').clone();t.attr("data-pbid",n),u.attr("data-pbid",n),d.append(u),s(l.attr("id"))}}});
