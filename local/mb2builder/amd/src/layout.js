// This file is part of Moodle - http://moodle.org/
//
// Moodle is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// Moodle is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.

/**
 *
 * @package    local_mb2builder
 * @copyright  2018 - 2022 Mariusz Boloz (mb2themes.com)
 * @license    Commercial https://themeforest.net/licenses
 */
define(["jquery","jqueryui","local_mb2builder/senddemo","local_mb2builder/carousel","local_mb2builder/selectors","local_mb2builder/elements","local_mb2builder/helper"],function(e,t,a,l,o,s,n){var i=function(t){var s=e(".mb2-pb-sortable-"+t+"s");s.sortable({axis:"element"!==t&&"subelement"!==t&&("column"===t?"x":"y"),placeholder:"ui-state-highlight",forcePlaceholderSize:!0,handle:"."+t+"-drag-handle",connectWith:"column"!==t&&"subelement"!==t&&"tab"!==t&&".mb2-pb-sortable-"+t+"s",opacity:.95,start:function(t,a){var l=e(a.item).outerHeight(!0),o=e(a.item).outerWidth(!0);s.find(">.ui-state-highlight").addClass(e(a.item).attr("class")),s.find(">.ui-state-highlight").css("height",l),s.find(">.ui-state-highlight").css("width",o)},stop:function(e,t){if(t.item.hasClass("mb2-pb-carousel_item")&&l.carouselSortItems(t.item),t.item.hasClass("mb2-pb-carousel")){var s=t.item.find(o.layout.carousel);l.carouselDestroy(s.attr("id")),l.carouselInit(s.attr("id"))}a.saveDemo()}})},r=function(e){var t=0,a="",l=[{name:"mobcenter",prefix:"mobcenter"},{name:"align",prefix:"align-"},{name:"scheme",prefix:""},{name:"custom_class",prefix:""}];for(t=0;t<l.length;t++)void 0!==e&&(a+=" "+l[t].prefix+e[l[t].name]);return a},m=function(e){var t="";if("object"==typeof e){for(const[a,l]of Object.entries(e))"col"!==a&&(t+=l?" data-"+a+'="'+l+'"':"");return t}},c=function(e){var t="";if("object"==typeof e){t+=' style="';for(const[a,l]of Object.entries(e))"bgimage"!==a&&"height"!==a||!l||(t+="bgimage"===a?"background-image:url('"+l+"');":"",t+="height"===a?"min-height:"+l+"px;":"");return t+='"'}},u=function(t){var a,l=e(o.builder.langspan),s="",i=[12],u=[],d=[],b=[],p=[],f=[],h=0,v=0;12!==t&&(i=t.split(","));var g=e(o.layout.row+"-active");for((a=g.length)&&g.find(o.layout.pbcolumn).each(function(t,a){u[t]=e(this).find(o.layout.elementcontainer).html(),d[t]=n.dataAttribs(e(this)),b[t]=e(this).attr("style"),p[t]=e(this).find(o.layout.column_inner).attr("style"),f[t]=e(this).find(o.layout.column_inner+"-bg").attr("style")}),v=0;v<i.length;v++){if(s+='<div class="mb2-pb-column col-md-'+i[v]+r(d[v])+'" data-col="'+i[v]+'"'+m(d[v])+c(d[v])+">",s+='<div class="column-helper"></div>',s+='<div class="mb2-pb-actions">',s+="<span>"+l.data("col")+"</span>",s+='<span href="#" class="column-drag-handle" title="'+l.data("move")+'">',s+='<i class="fa fa-arrows"></i> ',s+="</span>",s+='<a href="#" class="settings-column" title="'+l.data("settings")+'" data-modal="#mb2-pb-modal-settings-column">',s+='<i class="fa fa-pencil"></i> ',s+="</a>",s+='<a href="#" class="mb2-pb-add-element" title="'+l.data("addelement")+'" data-modal="#mb2-pb-modal-elements">',s+='<i class="fa fa-plus"></i> ',s+="</a>",s+="</div>",s+='<div class="column-inner" style="'+(p[v]?p[v]:"padding-bottom:30px")+'">',s+='<div class="mb2-pb-sortable-elements clearfix">',a&&v==i.length-1){if(u.length>v)for(h=v;h<u.length;h++)s+=u[h]}else u[v]&&(s+=u[v]);s+="</div>",s+="</div>",s+='<div class="mb2-pb-column-footer">',s+='<a href="#" class="mb2-pb-add-element" title="'+l.data("addelement")+'" data-modal="#mb2-pb-modal-elements">&plus; '+l.data("addelement")+"</a>",s+="</div>",s+='<div class="column-inner-bg" style="'+f[v]+'"></div>',s+="</div>"}return s};return{layoutInit:function(){i("section"),i("row"),i("column"),i("element"),i("subelement"),i("tab")},elementHtml:function(t,a,n){var i=e(".mb2-pb-template-"+t).clone();return i.removeClass("mb2-pb-template-"+t),i.attr("data-id",t),"accordion"===t&&s.accordionPrepare(i),"tabs"===t&&s.tabsPrepare(i,!1),"carousel"!==t&&"pbmainslider"!==t||l.carouselPrepare(i),"courses"!==t&&"categories"!==t||l.coursesPrepare(i),"animnum"===t&&s.animnumInit(i,!0),(a=i.find(o.layout.subelement)).length&&a.attr("data-id",n),i},deactivateSections:function(){e(o.layout.section).removeClass("mb2-pb-section-active"),e(o.layout.row).removeClass("mb2-pb-row-active"),e(o.layout.pbcolumn).removeClass("mb2-pb-column-active"),e(o.layout.element).removeClass("mb2-pb-element-active"),e(o.layout.subelement).removeClass("mb2-pb-subelement-active"),e(o.builder.modal).removeClass("mb2-pb-modal-wider"),e(o.builder.collapsedgroup).removeClass("open")},rowHtml:function(t){var a=e(o.layout.templaterow).clone();a.removeClass("mb2-pb-template-row");var l=u(t);return a.find(o.layout.sortable_columns).append(l),a},buildRowColumns:u,currentColumns:function(t){var a=["12"];return t.closest(o.layout.row).find(o.layout.pbcolumn).each(function(t){a[t]=e(this).attr("data-col")}),a.join(",")},rowCurrentClass:function(t,a){a.each(function(){t===e(this).attr("data-row_variant")&&e(this).addClass("current-layout")})},columnsToList:function(e){var t=e.find(".mb2-pb-content-list");t.removeClass("swiper-wrapper"),t.removeClass("theme-boxes"),t.removeClass("theme-col-"+e.attr("data-columns")),t.removeClass("gutter-"+e.attr("data-gutter")),t.find(">div").removeClass("theme-box")}}});
