// This file is part of Moodle - http://moodle.org/
//
// Moodle is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// Moodle is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.

/**
 *
 * @package    local_mb2builder
 * @copyright  2018 - 2022 Mariusz Boloz (mb2themes.com)
 * @license    Commercial https://themeforest.net/licenses
 */
define(["jquery","local_mb2builder/selectors","local_mb2builder/helper","local_mb2builder/carousel","local_mb2builder/parallax","local_mb2builder/typed"],function(a,t,e,n,i,r){var s=function(n){var i=e.uniqId(),r=0;n.attr("id","theme-accordion-"+i),n.find(t.elements.accordion_item).each(function(){r++,a(this).find("[data-parent]").attr("data-parent","#theme-accordion-"+i),a(this).find('[data-toggle="collapse"]').attr("data-target","#accordion-item-"+i+r),a(this).find('[data-toggle="collapse"]').attr("aria-controls","#accordion-item-"+i+r),a(this).find(".collapse").attr("id","accordion-item-"+i+r)})},l=function(t,n){var i=e.uniqId(),r=0;n?t.find(".nav-link").each(function(){r++;var t=a(this).attr("aria-controls");a(this).attr("href","#tab-"+i+r),a(this).attr("aria-controls","tab-"+i+r);var e=a(this).closest(".mb2-pb-tabs").find('[id="'+t+'"]');e.attr("id","tab-"+i+r),e.attr("aria-labelledby","tab-"+i+r)}):(t.find(".nav-link").attr("href","#tab-"+i),t.find(".nav-link").attr("aria-controls","tab-"+i),t.find(".tab-pane").attr("id","tab-"+i),t.find(".tab-pane").attr("aria-labelledby","tab-"+i))},d=function(t,e){t.closest(".mb2-pb-tabs").find(".nav-link").removeClass("active"),t.closest(".mb2-pb-tabs").find(".tab-pane").removeClass("active"),e.addClass("active"),a('[id="'+e.attr("aria-controls")+'"]').addClass("active")},o=function(a){var e=a.find(t.elements.animnum_item_number),n=a.closest(t.elements.animnum).attr("data-aspeed");n=Number(n),a.prop("Counter",0).stop().animate({Counter:a.attr("data-number")},{duration:n,easing:"swing",step:function(a){e.text(this.Counter.toFixed())}})};return{accordionPrepare:s,tabsPrepare:l,animnumInit:function(e,n){(e=e||a(t.elements.animnum)).find(t.elements.animnum_item).each(function(){var t=a(this),e=!0;n?o(t):t.bind("inview",function(a,n){n&&e&&(e=!1,setTimeout(function(){o(t)},350))})})},accordionParent:function(a,t){var e=t.attr("id"),n=t.find('[data-toggle="collapse"]'),i=t.find(".collapse");1==a.val()?(n.attr("data-parent","#"+e),i.attr("data-parent","#"+e)):(n.attr("data-parent",""),i.attr("data-parent",""))},tabsActivateItem:d,accordionActivateItem:function(a){var e=a.closest(t.layout.element).find("[data-collapse]");e.attr("aria-expanded","false"),e.addClass("collapsed"),a.closest(t.layout.element).find(".collapse").removeClass("show"),a.find("[data-collapse]").attr("aria-expanded","true"),a.find("[data-collapse]").removeClass("collapsed"),a.find(".collapse").addClass("show")},tabsDuplicateItem:function(a,t){var n=e.uniqId(),i=a.closest(".mb2-pb-subelement").find(".nav-link"),r=t.find(".nav-link"),s=i.closest(".mb2-pb-tabs").find('[id="'+i.attr("aria-controls")+'"]').clone();r.attr("href","#tab-"+n),r.attr("aria-controls","tab-"+n),s.attr("id","tab-"+n),s.attr("aria-labelledby","tab-"+n),i.closest(".mb2-pb-tabs").find(".tab-content").append(s),d(i,r)},runElements:function(e){var d=e.find(t.layout.carousel);d.length&&d.each(function(){n.carouselPrepare(e),n.carouselInit(a(this).attr("id"))});var o=e.find(t.elements.accordion),c=e.hasClass("mb2-pb-accordion")?e:o;(o.length||e.hasClass("mb2-pb-accordion"))&&c.each(function(){s(a(this))});var b=e.find(t.elements.tabs),m=e.hasClass("mb2-pb-tabs")?e:b;(b.length||e.hasClass("mb2-pb-tabs"))&&m.each(function(){l(a(this),!0)});var f=e.find(".parallax1"),p=e.hasClass("parallax1")?e:f;(f.length||e.hasClass("parallax1"))&&p.each(function(){i.parallaxDestroy(a(this)),a(this).css("background-image","url('"+a(this).attr("data-bgimage")+"')"),i.parallaxInit(a(this))});var u=e.find(t.elements.heading+" .typed"),h=e.hasClass("mb2-pb-heading")?e:e.find(t.elements.heading);(u.length||e.hasClass("mb2-pb-heading")&&e.find(".typed").length)&&h.each(function(){var t=a(this).find(".heading");r.typedPrepare(a(this)),r.beforeTypedInit(t.attr("id")),r.typedInit(t.attr("id"))})}}});
